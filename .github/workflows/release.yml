name: Attach TAR.GZ files to release

on:
  push:
    tags:
      - "*"

permissions:
  contents: write

jobs:
  upload-assets:
    runs-on: docker

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4   # ✅ RICHTIG!

      - name: Build tempfile
        run: |
          sh ./dummy.sh

      - name: Find .tar.gz files
        id: find_files
        run: |
          files=$(find . -type f -name "*.tar.gz")
          if [ -z "$files" ]; then
            echo "Keine .tar.gz-Dateien gefunden."
            echo "files=" >> $GITHUB_OUTPUT
          else
            echo "Gefundene Dateien:"
            echo "$files"
            echo "files<<EOF" >> $GITHUB_OUTPUT
            echo "$files" >> $GITHUB_OUTPUT
            echo "EOF" >> $GITHUB_OUTPUT
          fi

      - name: Upload each .tar.gz to release
        if: steps.find_files.outputs.files != ''
        uses: softprops/action-gh-release@v2
        with:
          files: |
            ${{ steps.find_files.outputs.files }}
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      - name: Delete .tar.gz after upload or test
        if: steps.find_files.outputs.files != ''
        run: |
          echo "${{ steps.find_files.outputs.files }}" | xargs rm -f
          echo "Dateien gelöscht."
